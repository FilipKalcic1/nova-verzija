# =============================================================================
# MobilityOne WhatsApp Bot - ConfigMap
#
# NON-SENSITIVE configuration values
# For secrets, use secrets.yaml
# =============================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: mobility-config
  labels:
    app: mobility-bot
data:
  # Application settings
  APP_ENV: "production"
  APP_NAME: "MobilityOne Bot"
  LOG_LEVEL: "WARNING"  # Reduce noise in production

  # Database pool settings (per pod)
  DB_POOL_SIZE: "10"
  DB_MAX_OVERFLOW: "20"
  DB_POOL_RECYCLE: "3600"

  # Redis settings
  REDIS_MAX_CONNECTIONS: "50"

  # AI settings
  AI_MAX_ITERATIONS: "6"
  AI_TEMPERATURE: "0.2"
  AI_MAX_TOKENS: "1500"
  MAX_TOOLS_FOR_LLM: "25"

  # Rate limiting
  RATE_LIMIT_PER_MINUTE: "20"
  RATE_LIMIT_WINDOW: "60"

  # Cache TTLs
  CACHE_TTL_TOKEN: "3500"
  CACHE_TTL_USER: "300"
  CACHE_TTL_CONTEXT: "86400"
  CACHE_TTL_TOOLS: "3600"

  # Azure OpenAI
  AZURE_OPENAI_API_VERSION: "2024-08-01-preview"
  AZURE_OPENAI_DEPLOYMENT_NAME: "gpt-4o-mini"
  AZURE_OPENAI_EMBEDDING_DEPLOYMENT: "text-embedding-ada-002"

---
# =============================================================================
# SECRETS TEMPLATE - DO NOT COMMIT ACTUAL VALUES
#
# Create actual secret with:
# kubectl create secret generic mobility-secrets \
#   --from-literal=DATABASE_URL="postgresql+asyncpg://..." \
#   --from-literal=REDIS_URL="redis://..." \
#   --from-literal=AZURE_OPENAI_API_KEY="..." \
#   ...
# =============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: mobility-secrets
  labels:
    app: mobility-bot
type: Opaque
stringData:
  # Database (REQUIRED)
  DATABASE_URL: "postgresql+asyncpg://bot_user:PASSWORD@postgres-service:5432/mobility_db"
  BOT_DATABASE_URL: "postgresql+asyncpg://bot_user:PASSWORD@postgres-service:5432/mobility_db"
  ADMIN_DATABASE_URL: "postgresql+asyncpg://admin_user:PASSWORD@postgres-service:5432/mobility_db"

  # Redis (REQUIRED)
  REDIS_URL: "redis://redis-service:6379/0"

  # MobilityOne API (REQUIRED)
  MOBILITY_API_URL: "https://api.mobilityone.example.com"
  MOBILITY_AUTH_URL: "https://auth.mobilityone.example.com/oauth2/token"
  MOBILITY_CLIENT_ID: "YOUR_CLIENT_ID"
  MOBILITY_CLIENT_SECRET: "YOUR_CLIENT_SECRET"
  MOBILITY_TENANT_ID: "YOUR_DEFAULT_TENANT_ID"

  # Azure OpenAI (REQUIRED)
  AZURE_OPENAI_ENDPOINT: "https://YOUR_RESOURCE.openai.azure.com"
  AZURE_OPENAI_API_KEY: "YOUR_API_KEY"

  # Infobip WhatsApp (REQUIRED)
  INFOBIP_API_KEY: "YOUR_INFOBIP_API_KEY"
  INFOBIP_BASE_URL: "api.infobip.com"
  INFOBIP_SENDER_NUMBER: "YOUR_WHATSAPP_NUMBER"

  # Optional
  SENTRY_DSN: ""
